import requestsimport pandas as pdimport osimport vectorbt as vbt# API_KEY = os.getenv("ALPHAVANTAGE_API_KEY")data_dir = '/Users/chingyungau/Desktop/Data/market_data/raw'def get_fx_df(ccy, field='close'):    if ccy == 'USD':        df = pd.Series(1, index=pd.bdate_range('1900-01-01', pd.Timestamp.today().normalize())).rename('USD').to_frame()        return df    params = {        "function": "FX_DAILY",        "from_symbol": "USD",        "to_symbol": f"{ccy}".upper(),        "outputsize": "full",        "apikey": os.getenv("ALPHAVANTAGE_API_KEY")    }    r = requests.get("https://www.alphavantage.co/query", params=params, timeout=30)    r.raise_for_status()    data = r.json()    ts = data.get("Time Series FX (Daily)", {})    df = pd.DataFrame.from_dict(ts, orient="index").rename(columns={            "1. open": "open", "2. high": "high", "3. low": "low", "4. close": "close"        })    df.index = pd.to_datetime(df.index)    df = df.sort_index()        if field is not None:        df = df[[field.lower()]].astype(float).rename(columns={field.lower(): f"USD{ccy}"})    return dfdef get_fx_dfs(ccys, field='close'):    output = {field: pd.concat([get_fx_df(ccy, field) for ccy in ccys], axis=1)}    return outputdef get_stock_dfs(symbols, fields=['Closes']):    data = vbt.YFData.download(        symbols=symbols,        interval="1d",          # '1d' | '1wk' | '1mo' | intraday like '1h' if available        missing_index="drop",   # drop missing timestamps for a clean shared index    )    output = {field: data.get(field.capitalize()) for field in fields}    return outputdef get_index_dfs(indices, fields=['Close']):    fname = 'indices_data.xlsx'    fpath = os.path.join(data_dir, fname)    xls = pd.ExcelFile(fpath)    dfs = {index: pd.read_excel(xls, sheet_name=index, index_col=0, parse_dates=False)            for index in indices}    for index, df in dfs.items():        df.index = pd.to_datetime(df.index).normalize()    output = {field: pd.concat([df['Close'].rename(index) for index, df in dfs.items()], axis=1)                      for field in fields}    return output        if __name__ == '__main__':        if 0:        data_df = get_fx_df('GBP')        print(data_df)        if 0:        data_dfs = get_stock_dfs(['0001.HK', '0019.HK'], ['Close', 'Volume'])        print(data_dfs['Close'])        print(data_dfs['Volume'])            if 1:        data_dfs = get_index_dfs(['TWSE', 'KOSPI2'])        print(data_dfs['Close'])                            